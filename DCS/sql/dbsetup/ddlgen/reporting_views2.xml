<!DOCTYPE schema  SYSTEM "dynamosystemresource:/atg/dtds/sql/ddl_1.0.dtd">
<schema name="reporting_views2" description="">
<comment><![CDATA[ @version $Id: //product/DCS/version/10.0.3/templates/DCS/sql/reporting_views2.xml#3 $$Change: 655658 $]]></comment>
   <comment><![CDATA[
       drptw_prod_sales calculates several statistics over each week on a per-product basis 
   ]]></comment>
   <comment><![CDATA[drptw_prod_sales calculates several statistics over each week on a per-product basis 
   ]]></comment>
   <view name="drptw_prod_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and trunc(o.submitted_date, 'DAY') = wb.week 
	and trunc(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = trunc(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id
group by trunc(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold,
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	dbo.TRUNC(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wb.week 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id
group by 
	dbo.TRUNC(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold,
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wb.week 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and i.catalog_ref_id = s.sku_id
group by 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold,
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wb.week 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and i.catalog_ref_id = s.sku_id
group by DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold,
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock  ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wb.week 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold,
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptm_prod_sales calculates several statistics over each month on a per-product basis 
   ]]></comment>
   <view name="drptm_prod_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and trunc(o.submitted_date, 'MON') = mb.month 
	and trunc(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = trunc(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id
group by trunc(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold,
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and dbo.TRUNC(o.submitted_date, 'MON') = mb.month 
	and dbo.TRUNC(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id
group by 
	dbo.TRUNC(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold,
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mb.month 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and i.catalog_ref_id = s.sku_id
group by 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold,
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') = mb.month 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and i.catalog_ref_id = s.sku_id
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold,
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mb.month 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mc.month 
	and si.product_id = i.product_id 
	and mot.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold,
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptq_prod_sales calculates several statistics over each quarter on a per-product basis 
   ]]></comment>
   <view name="drptq_prod_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and trunc(o.submitted_date, 'Q') = qb.quarter 
	and trunc(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = trunc(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id
group by trunc(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	qb.browses, 	
	qc.adds_to_cart, 
	qot.total_units_sold,
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and dbo.TRUNC(o.submitted_date, 'Q') = qb.quarter 
	and dbo.TRUNC(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id
group by 
	dbo.TRUNC(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	qb.browses, 	
	qc.adds_to_cart, 
	qot.total_units_sold,
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH)
 as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH)
 = qb.quarter 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH)
 = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH)
 
	and i.catalog_ref_id = s.sku_id
group by 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH)
, 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	qb.browses, 	
	qc.adds_to_cart, 
	qot.total_units_sold,
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
 as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
 = qb.quarter 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
 = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and i.catalog_ref_id = s.sku_id
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	qb.browses, 	
	qc.adds_to_cart, 
	qot.total_units_sold,
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qb.quarter 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and i.catalog_ref_id = s.sku_id
group by 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	qb.browses, 	
	qc.adds_to_cart, 
	qot.total_units_sold,
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drpta_prod_sales calculates several statistics over each year on a per-product basis 
   ]]></comment>
   <view name="drpta_prod_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and trunc(o.submitted_date, 'YEAR') = ab.year 
	and trunc(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = trunc(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id
group by trunc(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold,
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ab.year 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id
group by 
	dbo.TRUNC(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold,
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-01-01') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ab.year 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and i.catalog_ref_id = s.sku_id
group by 
	DATE_FORMAT(o.submitted_date, '%Y-01-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold,
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s
where o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') = ab.year 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and i.catalog_ref_id = s.sku_id
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold,
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  as year,
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev, 
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price * i.quantity)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s
where 
	o.order_id = i.order_ref 
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ab.year 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ac.year 
	and si.product_id = i.product_id 
	and aot.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and i.catalog_ref_id = s.sku_id
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101)) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup,
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold,
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptw_promo_sales calculates totals about products that were discounted
   ]]></comment>
   <comment><![CDATA[
       by the sample 'promo60003' promotion over each week
   ]]></comment>
   <view name="drptw_promo_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_promotion wpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and trunc(o.submitted_date, 'DAY') = wb.week 
	and trunc(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = trunc(o.submitted_date, 'DAY') 
	and wpt.week = trunc(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by trunc(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_promotion wpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wb.week 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and wpt.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	dbo.TRUNC(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_promotion wpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wb.week 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and wpt.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_promotion wpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wb.week 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and wpt.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_promotion wpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wb.week 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and wpt.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptm_promo_sales calculates totals about products that were discounted
   ]]></comment>
   <comment><![CDATA[
       by the sample 'promo60003' promotion over each month
   ]]></comment>
   <view name="drptm_promo_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_promotion mpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and trunc(o.submitted_date, 'MON') = mb.month 
	and trunc(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = trunc(o.submitted_date, 'MON') 
	and mpt.month = trunc(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by trunc(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_promotion mpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and dbo.TRUNC(o.submitted_date, 'MON') = mb.month 
	and dbo.TRUNC(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and mpt.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	dbo.TRUNC(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_promotion mpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mb.month 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and mpt.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_promotion mpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') = mb.month 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and mpt.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_promotion mpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mb.month 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mc.month 
	and si.product_id = i.product_id 
	and mot.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and mpt.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptq_promo_sales calculates totals about products that were discounted
   ]]></comment>
   <comment><![CDATA[
       by the sample 'promo60003' promotion over each quarter
   ]]></comment>
   <view name="drptq_promo_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot,
	dcs_sku s, 
	drptq_promotion qpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and trunc(o.submitted_date, 'Q') = qb.quarter 
	and trunc(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = trunc(o.submitted_date, 'Q') 
	and qpt.quarter = trunc(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by trunc(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot,
	dcs_sku s, 
	drptq_promotion qpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and dbo.TRUNC(o.submitted_date, 'Q') = qb.quarter 
	and dbo.TRUNC(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and qpt.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	dbo.TRUNC(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH), 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot,
	dcs_sku s, 
	drptq_promotion qpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qb.quarter 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and qpt.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot,
	dcs_sku s, 
	drptq_promotion qpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') = qb.quarter 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') 
	and qpt.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot,
	dcs_sku s, 
	drptq_promotion qpt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qb.quarter 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and qpt.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drpta_promo_sales calculates totals about products that were discounted
   ]]></comment>
   <comment><![CDATA[
       by the sample 'promo60003' promotion over each year
   ]]></comment>
   <view name="drpta_promo_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_promotion apt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and trunc(o.submitted_date, 'YEAR') = ab.year 
	and trunc(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = trunc(o.submitted_date, 'YEAR') 
	and apt.year = trunc(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by trunc(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_promotion apt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ab.year 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and apt.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	dbo.TRUNC(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-01-01') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_promotion apt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ab.year 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and apt.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	DATE_FORMAT(o.submitted_date, '%Y-01-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_promotion apt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') = ab.year 
	and DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and apt.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1')
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="promo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="promo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as promo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as promo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_promotion apt, 
	dcspp_amtinfo_adj aa,
	dcspp_price_adjust pa
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ab.year 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ac.year 
	and si.product_id = i.product_id 
	and aot.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and apt.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and i.catalog_ref_id = s.sku_id
	and i.price_info = aa.amount_info_id 
	and aa.adjustments = pa.adjustment_id 
	and pa.pricing_model = 'promo60003'
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101)) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptw_m_18_25_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 18-25 each week
   ]]></comment>
   <view name="drptw_m18_25_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_18_25 wpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and trunc(o.submitted_date, 'DAY') = wb.week 
	and trunc(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = trunc(o.submitted_date, 'DAY') 
	and wpt.week = trunc(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 18) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 25)
group by trunc(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_18_25 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wb.week 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and wpt.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	dbo.TRUNC(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_18_25 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wb.week 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and wpt.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 18) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 25)
group by 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
      <view-db db="db2">
         <view-body><![CDATA[
select DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_18_25 wpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wb.week 
	and DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and wpt.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 180000 
	and (o.submitted_date - u.date_of_birth) < 250000 
group by DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_18_25 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wb.week 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and wpt.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptm_m_18_25_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 18-25 each month
   ]]></comment>
   <view name="drptm_m18_25_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_18_25 mpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and trunc(o.submitted_date, 'MON') = mb.month 
	and trunc(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = trunc(o.submitted_date, 'MON') 
	and mpt.month = trunc(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 18) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 25)
group by trunc(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_18_25 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and dbo.TRUNC(o.submitted_date, 'MON') = mb.month 
	and dbo.TRUNC(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and mpt.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	dbo.TRUNC(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_18_25 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mb.month 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and mpt.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 18) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 25)
group by 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_18_25 mpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and mb.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01')
	and mc.month=DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01')  
	and si.product_id = i.product_id 
	and mot.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and mpt.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01')
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 180000 
	and (o.submitted_date - u.date_of_birth) < 250000 
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_18_25 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mb.month 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mc.month 
	and si.product_id = i.product_id 
	and mot.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and mpt.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptq_m_18_25_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 18-25 each quarter
   ]]></comment>
   <view name="drptq_m18_25_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_18_25 qpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and trunc(o.submitted_date, 'Q') = qb.quarter 
	and trunc(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = trunc(o.submitted_date, 'Q') 
	and qpt.quarter = trunc(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 18) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 25)
group by trunc(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_18_25 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and dbo.TRUNC(o.submitted_date, 'Q') = qb.quarter 
	and dbo.TRUNC(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and qpt.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	dbo.TRUNC(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_18_25 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qb.quarter 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and qpt.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 18) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 25)
group by 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')  as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_18_25 qpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and qb.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and qc.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and si.product_id = i.product_id 
	and qot.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and qpt.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 180000 
	and (o.submitted_date - u.date_of_birth) < 250000 
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_18_25 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qb.quarter 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and qpt.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drpta_m_18_25_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 18-25 each year
   ]]></comment>
   <view name="drpta_m18_25_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_18_25 apt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and trunc(o.submitted_date, 'YEAR') = ab.year 
	and trunc(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = trunc(o.submitted_date, 'YEAR') 
	and apt.year = trunc(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 18) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 25)
group by trunc(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev,
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_18_25 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ab.year 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and apt.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	dbo.TRUNC(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev,
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-01-01') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_18_25 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ab.year 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and apt.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 18) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 25)
group by 
	DATE_FORMAT(o.submitted_date, '%Y-01-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev,
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_18_25 apt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and ab.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1')
	and ac.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and si.product_id = i.product_id 
	and aot.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and apt.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 180000 
	and (o.submitted_date - u.date_of_birth) < 250000 
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev,
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_18_25 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ab.year 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ac.year 
	and si.product_id = i.product_id 
	and aot.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and apt.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 18) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 25)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101)) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev,
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptw_m_25_39_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 25-39 each week
   ]]></comment>
   <view name="drptw_m25_39_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_25_39 wpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and trunc(o.submitted_date, 'DAY') = wb.week 
	and trunc(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = trunc(o.submitted_date, 'DAY') 
	and wpt.week = trunc(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 25) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 39)
group by trunc(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'DAY') as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_25_39 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wb.week 
	and dbo.TRUNC(o.submitted_date, 'DAY') = wc.week 
	and si.product_id = i.product_id 
	and wot.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and wpt.week = dbo.TRUNC(o.submitted_date, 'DAY') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	dbo.TRUNC(o.submitted_date, 'DAY'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_25_39 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wb.week 
	and DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and wpt.week = DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 25) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 39)
group by 
	DATE_SUB(DATE(o.submitted_date), INTERVAL DAYOFWEEK(o.submitted_date)-1 DAY), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_25_39 wpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and wb.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1)
	and wc.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1)
	and si.product_id = i.product_id 
	and wot.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and wpt.week = DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 250000 
	and (o.submitted_date - u.date_of_birth) < 390000
group by DATE(DAYS(o.submitted_date) - DAYOFWEEK(o.submitted_date) +1), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="week"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="weeks_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) as week, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / wpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / wot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as weeks_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / wpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / wot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	wb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / wb.browses) as shop_to_purc_conv, 
	wc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / wc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptw_browses wb, 
	drptw_carts wc, 
	drpt_sku_stock si, 
	drptw_orders wot, 
	dcs_sku s, 
	drptw_male_25_39 wpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = wc.product_id 
	and i.product_id = wb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wb.week 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) = wc.week 
	and si.product_id = i.product_id 
	and wot.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and wpt.week = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(WEEKDAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	wb.browses, 
	wc.adds_to_cart, 
	wot.total_units_sold, 
	wot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	wpt.total_units_sold, 
	wpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptm_m_25_39_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 25-39 each month
   ]]></comment>
   <view name="drptm_m25_39_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_25_39 mpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and trunc(o.submitted_date, 'MON') = mb.month 
	and trunc(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = trunc(o.submitted_date, 'MON') 
	and mpt.month = trunc(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 25) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 39)
group by trunc(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'MON') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_25_39 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and dbo.TRUNC(o.submitted_date, 'MON') = mb.month 
	and dbo.TRUNC(o.submitted_date, 'MON') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and mpt.month = dbo.TRUNC(o.submitted_date, 'MON') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	dbo.TRUNC(o.submitted_date, 'MON'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_25_39 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mb.month 
	and DATE_FORMAT(o.submitted_date, '%Y-%m-01') = mc.month 
	and si.product_id = i.product_id 
	and mot.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and mpt.month = DATE_FORMAT(o.submitted_date, '%Y-%m-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 25) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 39)
group by 
	DATE_FORMAT(o.submitted_date, '%Y-%m-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_25_39 mpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and mb.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01')
	and mc.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01')
	and si.product_id = i.product_id 
	and mot.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and mpt.month = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 250000 
	and (o.submitted_date - u.date_of_birth) < 390000
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(MONTH(o.submitted_date) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="month"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="months_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) as month, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / mpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / mot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as months_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / mpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / mot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	mb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / mb.browses) as shop_to_purc_conv, 
	mc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / mc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptm_browses mb, 
	drptm_carts mc, 
	drpt_sku_stock si, 
	drptm_orders mot, 
	dcs_sku s, 
	drptm_male_25_39 mpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = mc.product_id 
	and i.product_id = mb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mb.month 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) = mc.month 
	and si.product_id = i.product_id 
	and mot.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and mpt.month = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAY, o.submitted_date), o.submitted_date), 101)), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	mb.browses, 
	mc.adds_to_cart, 
	mot.total_units_sold, 
	mot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	mpt.total_units_sold, 
	mpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drptq_m_25_39_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 25-39 each quarter
   ]]></comment>
   <view name="drptq_m25_39_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_25_39 qpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and trunc(o.submitted_date, 'Q') = qb.quarter 
	and trunc(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = trunc(o.submitted_date, 'Q') 
	and qpt.quarter = trunc(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 25) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 39)
group by trunc(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'Q') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_25_39 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and dbo.TRUNC(o.submitted_date, 'Q') = qb.quarter 
	and dbo.TRUNC(o.submitted_date, 'Q') = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and qpt.quarter = dbo.TRUNC(o.submitted_date, 'Q') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	dbo.TRUNC(o.submitted_date, 'Q'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_25_39 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qb.quarter 
	and DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and qpt.quarter = DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH) 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 25) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 39)
group by 
	DATE_ADD(DATE_FORMAT(o.submitted_date, '%Y-01-01'), INTERVAL (QUARTER(o.submitted_date)-1)*3 MONTH), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_25_39 qpt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and qb.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') 
	and qc.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01')
	and si.product_id = i.product_id 
	and qot.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') 
	and qpt.quarter = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2
	and (o.submitted_date - u.date_of_birth) >= 250000 
	and (o.submitted_date - u.date_of_birth) < 390000
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-'||RTRIM(CAST(((QUARTER(o.submitted_date) - 1)*3+1) AS CHAR(2)))||'-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="quarter"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="quarters_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  as quarter, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / qpt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / qot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as quarters_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / qpt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / qot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	qb.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / qb.browses) as shop_to_purc_conv, 
	qc.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / qc.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drptq_browses qb, 
	drptq_carts qc, 
	drpt_sku_stock si, 
	drptq_orders qot, 
	dcs_sku s, 
	drptq_male_25_39 qpt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = qc.product_id 
	and i.product_id = qb.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qb.quarter 
	and CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  = qc.quarter 
	and si.product_id = i.product_id 
	and qot.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and qpt.quarter = CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101)  
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(2),(DATEPART(QUARTER, o.submitted_date)-1)*3+1) + '/01/' + CONVERT(CHAR(4),DATEPART(YEAR, o.submitted_date)), 101) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	qb.browses, 
	qc.adds_to_cart, 
	qot.total_units_sold, 
	qot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	qpt.total_units_sold, 
	qpt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
   <comment><![CDATA[
       drpta_m_25_39_sales calculates totals about products that were purchased
   ]]></comment>
   <comment><![CDATA[
       by males aged 25-39 each year
   ]]></comment>
   <view name="drpta_m25_39_sales" description="">
      <view-db db="oracle">
         <view-body><![CDATA[
select trunc(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_25_39 apt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and trunc(o.submitted_date, 'YEAR') = ab.year 
	and trunc(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = trunc(o.submitted_date, 'YEAR') 
	and apt.year = trunc(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 >= 25) 
	and (MONTHS_BETWEEN(o.submitted_date, u.date_of_birth)/12 < 39)
group by trunc(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 	
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mssql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	dbo.TRUNC(o.submitted_date, 'YEAR') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_25_39 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ab.year 
	and dbo.TRUNC(o.submitted_date, 'YEAR') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and apt.year = dbo.TRUNC(o.submitted_date, 'YEAR') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	dbo.TRUNC(o.submitted_date, 'YEAR'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 	
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="mysql">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
             select 
	DATE_FORMAT(o.submitted_date, '%Y-01-01') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_25_39 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ab.year 
	and DATE_FORMAT(o.submitted_date, '%Y-01-01') = ac.year 
	and si.product_id = i.product_id 
	and aot.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and apt.year = DATE_FORMAT(o.submitted_date, '%Y-01-01') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 >= 25) 
	and (PERIOD_DIFF(DATE_FORMAT(o.submitted_date, '%Y%m'), DATE_FORMAT(u.date_of_birth, '%Y%m'))/12 < 39)
group by 
	DATE_FORMAT(o.submitted_date, '%Y-01-01'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 	
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="db2">
         <view-body><![CDATA[
select DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_25_39 apt, 
	dps_user u
where o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and ab.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1')
	and ac.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1')
	and si.product_id = i.product_id 
	and aot.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and apt.year = DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1') 
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = 2 
	and (o.submitted_date - u.date_of_birth) >= 250000 
	and (o.submitted_date - u.date_of_birth) < 390000
group by DATE(CAST(YEAR(o.submitted_date) AS CHAR(4))||'-1-1'), 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 	
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
<view-db db="sybase">
         <view-params>
            <view-param name="year"/>
            <view-param name="product_id"/>
            <view-param name="category_name"/>
            <view-param name="avg_cost"/>
            <view-param name="avg_list_price"/>
            <view-param name="avg_sale_price"/>
            <view-param name="avg_initial_markup"/>
            <view-param name="units_on_hand"/>
            <view-param name="units_sold"/>
            <view-param name="demo_units_sold_p"/>
            <view-param name="total_units_sold_p"/>
            <view-param name="years_on_hand"/>
            <view-param name="total_rev"/>
            <view-param name="cost_of_goods_sold"/>
            <view-param name="maintained_markup"/>
            <view-param name="demo_rev_p"/>
            <view-param name="total_rev_p"/>
            <view-param name="number_of_skus"/>
            <view-param name="skus_in_stock"/>
            <view-param name="skus_in_stock_p"/>
            <view-param name="browses"/>
            <view-param name="browse_conversions"/>
            <view-param name="shop_to_purc_conv"/>
            <view-param name="adds_to_cart"/>
            <view-param name="cart_conversions"/>
            <view-param name="cart_to_purc_conv"/>
         </view-params>
         <view-body><![CDATA[
select 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  as year, 
	i.product_id as product_id, 
	pri.category_name as category_name, 
	pri.avg_cost as avg_cost,
	pri.avg_list_price as avg_list_price, 
	pri.avg_sale_price as avg_sale_price, 
	pri.avg_initial_markup as avg_initial_markup,
	pri.units_on_hand as units_on_hand,
	sum(i.quantity) as units_sold, 
	(sum(i.quantity) / apt.total_units_sold) as demo_units_sold_p, 
	(sum(i.quantity) / aot.total_units_sold) as total_units_sold_p, 
	(pri.units_on_hand / sum(i.quantity)) as years_on_hand,
	sum(ai.amount) as total_rev,
	sum(s.wholesale_price * i.quantity) as cost_of_goods_sold,
	((sum(ai.amount) - sum(s.wholesale_price)) / sum(ai.amount)) as maintained_markup, 
	(sum(ai.amount) / apt.total_dollar_sales) as demo_rev_p,
	(sum(ai.amount) / aot.merch_rev) as total_rev_p,
	pri.number_of_skus as number_of_skus, 
	si.skus_in_stock as skus_in_stock,
	(si.skus_in_stock / pri.number_of_skus) as skus_in_stock_p,
	ab.browses as browses, 
	count(distinct i.order_ref) as browse_conversions,
	(count(distinct i.order_ref) / ab.browses) as shop_to_purc_conv, 
	ac.adds_to_cart as adds_to_cart, 
	count(i.order_ref) as cart_conversions, 
	(count(i.order_ref) / ac.adds_to_cart) as cart_to_purc_conv
from 
	dcspp_order o, 
	dcspp_item i, 
	drpt_products pri, 
	dcspp_amount_info ai,
	drpta_browses ab, 
	drpta_carts ac, 
	drpt_sku_stock si, 
	drpta_orders aot, 
	dcs_sku s, 
	drpta_male_25_39 apt, 
	dps_user u
where 
	o.order_id = i.order_ref 
	and o.state != 'FAILED' 
	and o.state != 'REMOVED'
	and i.product_id = pri.product_id 
	and i.price_info = ai.amount_info_id 
	and i.product_id = ac.product_id 
	and i.product_id = ab.product_id 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ab.year 
	and CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  = ac.year 
	and si.product_id = i.product_id 
	and aot.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and apt.year = CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101))  
	and i.catalog_ref_id = s.sku_id 
	and o.profile_id = u.id 
	and u.gender = '2' 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 >= 25) 
	and (DATEDIFF(MONTH, u.date_of_birth, o.submitted_date)/12 < 39)
group by 
	CONVERT(DATETIME, CONVERT(CHAR(10), DATEADD(DAY, 1-DATEPART(DAYOFYEAR, o.submitted_date), o.submitted_date), 101)) , 
	i.product_id, 
	pri.category_name, 
	pri.avg_cost,
	pri.avg_list_price, 
	pri.avg_sale_price, 
	pri.avg_initial_markup, 
	pri.units_on_hand, 
	ab.browses, 
	ac.adds_to_cart, 
	aot.total_units_sold, 
	aot.merch_rev, 
	pri.number_of_skus, 
	si.skus_in_stock, 
	apt.total_units_sold, 	
	apt.total_dollar_sales
         ]]></view-body>
      </view-db>
   </view>
</schema>
<!-- @version $Id: //product/DCS/version/10.0.3/templates/DCS/sql/reporting_views2.xml#3 $$Change: 655658 $ -->
